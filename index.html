<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITä»‹è­·AI v2.0</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; background: #0f0f23; color: #fff; min-height: 100vh; display: flex; flex-direction: column; }
        
        .header { background: linear-gradient(90deg, #1a1a2e, #16213e); padding: 1rem 2rem; border-bottom: 1px solid #2a2a3e; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.2rem; font-weight: 600; }
        .version { font-size: 0.8rem; color: #10b981; }
        
        .container { flex: 1; max-width: 800px; margin: 0 auto; width: 100%; padding: 0 1rem; display: flex; flex-direction: column; }
        .chat-area { flex: 1; padding: 2rem 0; overflow-y: auto; }
        
        .welcome { text-align: center; padding: 2rem; color: #9ca3af; }
        .welcome h2 { color: #fff; margin-bottom: 1rem; }
        .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-top: 2rem; }
        .card { background: #1a1a2e; border: 1px solid #374151; border-radius: 10px; padding: 1.5rem; text-align: center; cursor: pointer; transition: all 0.3s; }
        .card:hover { border-color: #10b981; transform: translateY(-2px); }
        .card-icon { font-size: 2rem; margin-bottom: 0.5rem; }
        .card-title { font-weight: 600; margin-bottom: 0.5rem; }
        .card-desc { font-size: 0.85rem; color: #9ca3af; }
        
        .message { margin-bottom: 1.5rem; display: flex; gap: 0.75rem; align-items: flex-start; }
        .message.user { flex-direction: row-reverse; }
        .avatar { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .avatar.ai { background: linear-gradient(135deg, #667eea, #764ba2); }
        .avatar.user { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .content { max-width: 70%; background: #1a1a2e; padding: 1rem 1.25rem; border-radius: 1rem; line-height: 1.5; border: 1px solid #374151; }
        .message.user .content { background: #2563eb; border-color: #3b82f6; }
        
        .typing { display: none; margin-bottom: 1.5rem; }
        .typing-content { background: #1a1a2e; padding: 1rem 1.25rem; border-radius: 1rem; border: 1px solid #374151; display: flex; align-items: center; gap: 0.5rem; max-width: 70%; }
        .dots { display: flex; gap: 4px; }
        .dots span { width: 6px; height: 6px; background: #9ca3af; border-radius: 50%; animation: typing 1.4s infinite; }
        .dots span:nth-child(2) { animation-delay: 0.2s; }
        .dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 60%, 100% { transform: translateY(0); opacity: 0.5; } 30% { transform: translateY(-8px); opacity: 1; } }
        
        .input-area { background: #1a1a2e; border: 1px solid #374151; border-radius: 1rem; padding: 1rem; margin-bottom: 2rem; display: flex; gap: 0.75rem; align-items: flex-end; }
        .input { flex: 1; background: transparent; border: none; outline: none; color: #fff; font-size: 1rem; resize: none; font-family: inherit; }
        .input::placeholder { color: #6b7280; }
        .btn { width: 40px; height: 40px; border-radius: 8px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; transition: all 0.2s; }
        .voice-btn { background: #ef4444; color: white; }
        .voice-btn:hover { background: #dc2626; }
        .send-btn { background: #10b981; color: white; }
        .send-btn:hover { background: #059669; }
        
        .status { position: fixed; bottom: 20px; right: 20px; background: #1a1a2e; border: 1px solid #374151; border-radius: 10px; padding: 0.75rem; font-size: 0.8rem; font-family: monospace; max-width: 300px; }
        .status.error { border-color: #ef4444; background: #7f1d1d; }
        .status.success { border-color: #10b981; background: #065f46; }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">ğŸ¤– ITä»‹è­·AI</div>
        <div class="version">v2.0</div>
    </header>
    
    <main class="container">
        <div class="chat-area" id="chatArea">
            <div class="welcome" id="welcome">
                <h2>å°‚é–€ã‚µãƒãƒ¼ãƒˆAIã¸ã‚ˆã†ã“ã</h2>
                <p>ITæ“ä½œã¨ã‚¨ãƒ³ã‚¿ãƒ¡ä½œå“ã«ã¤ã„ã¦ã€ãªã‚“ã§ã‚‚ãŠèããã ã•ã„</p>
                
                <div class="cards">
                    <div class="card" onclick="sendQuick('ã‚¹ãƒãƒ›ã®ä½¿ã„æ–¹ã‚’æ•™ãˆã¦')">
                        <div class="card-icon">ğŸ“±</div>
                        <div class="card-title">ã‚¹ãƒãƒ›ã‚µãƒãƒ¼ãƒˆ</div>
                        <div class="card-desc">åŸºæœ¬æ“ä½œã‹ã‚‰è¨­å®šã¾ã§</div>
                    </div>
                    <div class="card" onclick="sendQuick('ãƒ‘ã‚½ã‚³ãƒ³ã®èª¿å­ãŒæ‚ªã„')">
                        <div class="card-icon">ğŸ’»</div>
                        <div class="card-title">PC ã‚µãƒãƒ¼ãƒˆ</div>
                        <div class="card-desc">ãƒˆãƒ©ãƒ–ãƒ«è§£æ±ºã‚’ãŠæ‰‹ä¼ã„</div>
                    </div>
                    <div class="card" onclick="sendQuick('ãŠã™ã™ã‚ã®æ˜ ç”»ã‚’æ•™ãˆã¦')">
                        <div class="card-icon">ğŸ¬</div>
                        <div class="card-title">æ˜ ç”»ç›¸è«‡</div>
                        <div class="card-desc">ä½œå“é¸ã³ã‚„æ„Ÿæƒ³ãƒˆãƒ¼ã‚¯</div>
                    </div>
                    <div class="card" onclick="sendQuick('é¢ç™½ã„ã‚¢ãƒ‹ãƒ¡ã‚ã‚‹ï¼Ÿ')">
                        <div class="card-icon">ğŸ“º</div>
                        <div class="card-title">ã‚¢ãƒ‹ãƒ¡ç›¸è«‡</div>
                        <div class="card-desc">ãŠã™ã™ã‚ã‚„æ„Ÿæƒ³äº¤æ›</div>
                    </div>
                </div>
            </div>
            
            <div class="typing" id="typing">
                <div class="avatar ai">ğŸ¤–</div>
                <div class="typing-content">
                    <span>AI ãŒè€ƒãˆä¸­</span>
                    <div class="dots"><span></span><span></span><span></span></div>
                </div>
            </div>
        </div>
        
        <div class="input-area">
            <textarea class="input" id="input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..." rows="1"></textarea>
            <button class="btn voice-btn" onclick="toggleVoice()">ğŸ¤</button>
            <button class="btn send-btn" onclick="sendMessage()">ğŸ“¤</button>
        </div>
    </main>
    
    <div class="status" id="status">
        ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ä¸­...
    </div>

    <script>
        // === è¨­å®š ===
        const API_URL = 'https://script.google.com/macros/s/AKfycbyI4_81YN8I42rLLRQOVaNoPYOEkxziUMb6Kcr9GUqHoTVyud-UUuJoQKKITvw6GktY/exec'; // âš ï¸ Google Apps Scriptã®Web App URLã‚’è¨­å®š
        
        let isTyping = false;
        let recognition = null;
        let isListening = false;
        
        // === åˆæœŸåŒ– ===
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†', 'success');
            document.getElementById('input').focus();
            
            // éŸ³å£°èªè­˜è¨­å®š
            if ('webkitSpeechRecognition' in window) {
                const SpeechRecognition = window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'ja-JP';
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('input').value = transcript;
                    stopVoice();
                };
                
                recognition.onend = function() { stopVoice(); };
                recognition.onerror = function() { stopVoice(); };
            }
        });
        
        // === éŸ³å£°æ©Ÿèƒ½ ===
        function toggleVoice() {
            if (!recognition) {
                alert('éŸ³å£°èªè­˜ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
                startVoice();
            }
        }
        
        function startVoice() {
            isListening = true;
            document.querySelector('.voice-btn').innerHTML = 'ğŸ”´';
            updateStatus('éŸ³å£°å…¥åŠ›ä¸­...', 'success');
        }
        
        function stopVoice() {
            isListening = false;
            document.querySelector('.voice-btn').innerHTML = 'ğŸ¤';
            updateStatus('éŸ³å£°å…¥åŠ›çµ‚äº†', 'success');
        }
        
        // === ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ ===
        function sendQuick(message) {
            document.getElementById('input').value = message;
            sendMessage();
        }
        
        async function sendMessage() {
            const input = document.getElementById('input');
            const message = input.value.trim();
            
            if (!message || isTyping) return;
            
            // UIæ›´æ–°
            hideWelcome();
            addMessage(message, 'user');
            input.value = '';
            showTyping();
            updateStatus('AI ã«é€ä¿¡ä¸­...', 'success');
            
            try {
                const response = await callAPI(message);
                hideTyping();
                addMessage(response, 'ai');
                updateStatus('å¿œç­”å®Œäº†', 'success');
            } catch (error) {
                hideTyping();
                addMessage('ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\n\n' + error.message, 'ai');
                updateStatus('ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                console.error('API Error:', error);
            }
        }
        
        // === APIå‘¼ã³å‡ºã— ===
        async function callAPI(message) {
            updateStatus('APIæ¥ç¶šä¸­...', 'success');
            
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: message })
            });
            
            updateStatus('ãƒ¬ã‚¹ãƒãƒ³ã‚¹è§£æä¸­...', 'success');
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const data = await response.json();
            
            if (data.success && data.message) {
                return data.message;
            } else {
                throw new Error(data.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼');
            }
        }
        
        // === UIæ“ä½œ ===
        function addMessage(text, sender) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = `avatar ${sender}`;
            avatar.innerHTML = sender === 'ai' ? 'ğŸ¤–' : 'ğŸ‘¤';
            
            const content = document.createElement('div');
            content.className = 'content';
            content.innerHTML = text.replace(/\n/g, '<br>');
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            chatArea.appendChild(messageDiv);
            
            chatArea.scrollTop = chatArea.scrollHeight;
        }
        
        function showTyping() {
            isTyping = true;
            document.getElementById('typing').style.display = 'flex';
            document.getElementById('chatArea').scrollTop = document.getElementById('chatArea').scrollHeight;
        }
        
        function hideTyping() {
            isTyping = false;
            document.getElementById('typing').style.display = 'none';
        }
        
        function hideWelcome() {
            document.getElementById('welcome').style.display = 'none';
        }
        
        function updateStatus(message, type = '') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + type;
        }
        
        // === ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ===
        document.getElementById('input').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        document.getElementById('input').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });
    </script>
</body>
</html>
